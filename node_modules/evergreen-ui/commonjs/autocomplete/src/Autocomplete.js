'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _fuzzaldrinPlus = require('fuzzaldrin-plus');

var _fuzzaldrinPlus2 = _interopRequireDefault(_fuzzaldrinPlus);

var _downshift = require('downshift');

var _downshift2 = _interopRequireDefault(_downshift);

var _reactTinyVirtualList = require('react-tiny-virtual-list');

var _reactTinyVirtualList2 = _interopRequireDefault(_reactTinyVirtualList);

var _popover = require('../../popover');

var _typography = require('../../typography');

var _layers = require('../../layers');

var _AutocompleteItem = require('./AutocompleteItem');

var _AutocompleteItem2 = _interopRequireDefault(_AutocompleteItem);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var fuzzyFilter = function fuzzyFilter(items, input) {
  return _fuzzaldrinPlus2.default.filter(items, input);
};

var autocompleteItemRenderer = function autocompleteItemRenderer(props) {
  return _react2.default.createElement(_AutocompleteItem2.default, props);
};

// https://github.com/paypal/downshift/issues/164

var Autocomplete = function (_PureComponent) {
  _inherits(Autocomplete, _PureComponent);

  function Autocomplete() {
    var _ref;

    var _temp, _this, _ret;

    _classCallCheck(this, Autocomplete);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = Autocomplete.__proto__ || Object.getPrototypeOf(Autocomplete)).call.apply(_ref, [this].concat(args))), _this), _this.renderResults = function (_ref2) {
      var width = _ref2.width,
          inputValue = _ref2.inputValue,
          highlightedIndex = _ref2.highlightedIndex,
          selectItemAtIndex = _ref2.selectItemAtIndex,
          selectedItem = _ref2.selectedItem,
          getItemProps = _ref2.getItemProps;
      var _this$props = _this.props,
          title = _this$props.title,
          itemSize = _this$props.itemSize,
          itemsFilter = _this$props.itemsFilter,
          originalItems = _this$props.items,
          itemToString = _this$props.itemToString,
          _renderItem = _this$props.renderItem,
          popoverMaxHeight = _this$props.popoverMaxHeight,
          isFilterDisabled = _this$props.isFilterDisabled;


      var items = isFilterDisabled || inputValue.trim() === '' ? originalItems : itemsFilter(originalItems, inputValue);

      if (items.length === 0) return null;

      return _react2.default.createElement(
        _layers.Pane,
        { width: width },
        title && _react2.default.createElement(
          _layers.Pane,
          { padding: 8, borderBottom: 'extraMuted' },
          _react2.default.createElement(
            _typography.Text,
            { size: 200, color: 'muted', isUppercase: true },
            title
          )
        ),
        items.length > 0 && _react2.default.createElement(_reactTinyVirtualList2.default, {
          width: '100%',
          height: Math.min(items.length * itemSize, popoverMaxHeight),
          itemSize: itemSize,
          itemCount: items.length,
          scrollToIndex: highlightedIndex || 0,
          overscanCount: 3,
          scrollToAlignment: 'auto',
          renderItem: function renderItem(_ref3) {
            var index = _ref3.index,
                style = _ref3.style;

            var item = items[index];
            var itemString = itemToString(item);
            return _renderItem(getItemProps({
              item: item,
              key: itemString,
              index: index,
              style: style,
              children: itemString,
              onMouseUp: function onMouseUp() {
                selectItemAtIndex(index);
              },
              isSelected: selectedItem === item,
              isHighlighted: highlightedIndex === index
            }));
          }
        })
      );
    }, _temp), _possibleConstructorReturn(_this, _ret);
  }

  _createClass(Autocomplete, [{
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _props = this.props,
          children = _props.children,
          itemSize = _props.itemSize,
          renderItem = _props.renderItem,
          itemsFilter = _props.itemsFilter,
          popoverMaxHeight = _props.popoverMaxHeight,
          useSmartPositioning = _props.useSmartPositioning,
          popoverMinWidth = _props.popoverMinWidth,
          props = _objectWithoutProperties(_props, ['children', 'itemSize', 'renderItem', 'itemsFilter', 'popoverMaxHeight', 'useSmartPositioning', 'popoverMinWidth']);

      return _react2.default.createElement(
        _downshift2.default,
        props,
        function (_ref4) {
          var isOpen = _ref4.isOpen,
              inputValue = _ref4.inputValue,
              getItemProps = _ref4.getItemProps,
              selectedItem = _ref4.selectedItem,
              highlightedIndex = _ref4.highlightedIndex,
              selectItemAtIndex = _ref4.selectItemAtIndex,
              restDownshiftProps = _objectWithoutProperties(_ref4, ['isOpen', 'inputValue', 'getItemProps', 'selectedItem', 'highlightedIndex', 'selectItemAtIndex']);

          return _react2.default.createElement(
            'div',
            null,
            _react2.default.createElement(
              _popover.Popover,
              {
                isOpen: isOpen,
                minWidth: popoverMinWidth,
                content: function content(_ref5) {
                  var targetRect = _ref5.targetRect;
                  return _this2.renderResults({
                    width: Math.max(targetRect.width, popoverMinWidth),
                    inputValue: inputValue,
                    getItemProps: getItemProps,
                    selectedItem: selectedItem,
                    highlightedIndex: highlightedIndex,
                    selectItemAtIndex: selectItemAtIndex
                  });
                },
                minHeight: 0,
                animationDuration: 0,
                useSmartPositioning: useSmartPositioning
              },
              function (_ref6) {
                var isOpenPopover = _ref6.isOpen,
                    toggle = _ref6.toggle,
                    getRef = _ref6.getRef,
                    key = _ref6.key;
                return children(_extends({
                  key: key,
                  isOpen: isOpenPopover,
                  toggle: toggle,
                  getRef: getRef,
                  inputValue: inputValue,
                  selectedItem: selectedItem,
                  highlightedIndex: highlightedIndex,
                  selectItemAtIndex: selectItemAtIndex
                }, restDownshiftProps));
              }
            )
          );
        }
      );
    }
  }]);

  return Autocomplete;
}(_react.PureComponent);

Autocomplete.propTypes = _extends({
  title: _propTypes2.default.oneOfType([_propTypes2.default.string, _propTypes2.default.node]),
  items: _propTypes2.default.array.isRequired,
  selectedItem: _propTypes2.default.any,
  defaultSelectedItem: _propTypes2.default.any,
  itemToString: _propTypes2.default.func.isRequired,
  children: _propTypes2.default.func.isRequired,
  itemSize: _propTypes2.default.number,
  renderItem: _propTypes2.default.func,
  itemsFilter: _propTypes2.default.func,
  isFilterDisabled: _propTypes2.default.bool,
  popoverMinWidth: _propTypes2.default.number,
  popoverMaxHeight: _propTypes2.default.number,
  useSmartPositioning: _propTypes2.default.bool
}, _downshift2.default.propTypes);
Autocomplete.defaultProps = {
  itemToString: function itemToString(i) {
    return i ? String(i) : '';
  },
  itemSize: 32,
  itemsFilter: fuzzyFilter,
  isFilterDisabled: false,
  popoverMinWidth: 200,
  popoverMaxHeight: 240,
  useSmartPositioning: false,
  renderItem: autocompleteItemRenderer
};
exports.default = Autocomplete;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hdXRvY29tcGxldGUvc3JjL0F1dG9jb21wbGV0ZS5qcyJdLCJuYW1lcyI6WyJmdXp6eUZpbHRlciIsIml0ZW1zIiwiaW5wdXQiLCJmaWx0ZXIiLCJhdXRvY29tcGxldGVJdGVtUmVuZGVyZXIiLCJwcm9wcyIsIkF1dG9jb21wbGV0ZSIsInJlbmRlclJlc3VsdHMiLCJ3aWR0aCIsImlucHV0VmFsdWUiLCJoaWdobGlnaHRlZEluZGV4Iiwic2VsZWN0SXRlbUF0SW5kZXgiLCJzZWxlY3RlZEl0ZW0iLCJnZXRJdGVtUHJvcHMiLCJ0aXRsZSIsIml0ZW1TaXplIiwiaXRlbXNGaWx0ZXIiLCJvcmlnaW5hbEl0ZW1zIiwiaXRlbVRvU3RyaW5nIiwicmVuZGVySXRlbSIsInBvcG92ZXJNYXhIZWlnaHQiLCJpc0ZpbHRlckRpc2FibGVkIiwidHJpbSIsImxlbmd0aCIsIk1hdGgiLCJtaW4iLCJpbmRleCIsInN0eWxlIiwiaXRlbSIsIml0ZW1TdHJpbmciLCJrZXkiLCJjaGlsZHJlbiIsIm9uTW91c2VVcCIsImlzU2VsZWN0ZWQiLCJpc0hpZ2hsaWdodGVkIiwidXNlU21hcnRQb3NpdGlvbmluZyIsInBvcG92ZXJNaW5XaWR0aCIsImlzT3BlbiIsInJlc3REb3duc2hpZnRQcm9wcyIsInRhcmdldFJlY3QiLCJtYXgiLCJpc09wZW5Qb3BvdmVyIiwidG9nZ2xlIiwiZ2V0UmVmIiwicHJvcFR5cGVzIiwib25lT2ZUeXBlIiwic3RyaW5nIiwibm9kZSIsImFycmF5IiwiaXNSZXF1aXJlZCIsImFueSIsImRlZmF1bHRTZWxlY3RlZEl0ZW0iLCJmdW5jIiwibnVtYmVyIiwiYm9vbCIsImRlZmF1bHRQcm9wcyIsImkiLCJTdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsY0FBYyxTQUFkQSxX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OztBQTVKa0JoQyxZLENBQ1pzQyxTO0FBQ0w5QixTQUFPLG9CQUFVK0IsU0FBVixDQUFvQixDQUFDLG9CQUFVQyxNQUFYLEVBQW1CLG9CQUFVQyxJQUE3QixDQUFwQixDO0FBQ1A5QyxTQUFPLG9CQUFVK0MsS0FBVixDQUFnQkMsVTtBQUN2QnJDLGdCQUFjLG9CQUFVc0MsRztBQUN4QkMsdUJBQXFCLG9CQUFVRCxHO0FBQy9CaEMsZ0JBQWMsb0JBQVVrQyxJQUFWLENBQWVILFU7QUFDN0JsQixZQUFVLG9CQUFVcUIsSUFBVixDQUFlSCxVO0FBQ3pCbEMsWUFBVSxvQkFBVXNDLE07QUFDcEJsQyxjQUFZLG9CQUFVaUMsSTtBQUN0QnBDLGVBQWEsb0JBQVVvQyxJO0FBQ3ZCL0Isb0JBQWtCLG9CQUFVaUMsSTtBQUM1QmxCLG1CQUFpQixvQkFBVWlCLE07QUFDM0JqQyxvQkFBa0Isb0JBQVVpQyxNO0FBQzVCbEIsdUJBQXFCLG9CQUFVbUI7R0FDNUIsb0JBQVVWLFM7QUFmSXRDLFksQ0FrQlppRCxZLEdBQWU7QUFDcEJyQyxnQkFBYztBQUFBLFdBQU1zQyxJQUFJQyxPQUFPRCxDQUFQLENBQUosR0FBZ0IsRUFBdEI7QUFBQSxHQURNO0FBRXBCekMsWUFBVSxFQUZVO0FBR3BCQyxlQUFhaEIsV0FITztBQUlwQnFCLG9CQUFrQixLQUpFO0FBS3BCZSxtQkFBaUIsR0FMRztBQU1wQmhCLG9CQUFrQixHQU5FO0FBT3BCZSx1QkFBcUIsS0FQRDtBQVFwQmhCLGNBQVlmO0FBUlEsQztrQkFsQkhFLFkiLCJmaWxlIjoiQXV0b2NvbXBsZXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFB1cmVDb21wb25lbnQgfSBmcm9tICdyZWFjdCdcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCBmdXp6YWxkcmluIGZyb20gJ2Z1enphbGRyaW4tcGx1cydcbmltcG9ydCBEb3duc2hpZnQgZnJvbSAnZG93bnNoaWZ0J1xuaW1wb3J0IFZpcnR1YWxMaXN0IGZyb20gJ3JlYWN0LXRpbnktdmlydHVhbC1saXN0J1xuaW1wb3J0IHsgUG9wb3ZlciB9IGZyb20gJy4uLy4uL3BvcG92ZXInXG5pbXBvcnQgeyBUZXh0IH0gZnJvbSAnLi4vLi4vdHlwb2dyYXBoeSdcbmltcG9ydCB7IFBhbmUgfSBmcm9tICcuLi8uLi9sYXllcnMnXG5pbXBvcnQgQXV0b2NvbXBsZXRlSXRlbSBmcm9tICcuL0F1dG9jb21wbGV0ZUl0ZW0nXG5cbmNvbnN0IGZ1enp5RmlsdGVyID0gKGl0ZW1zLCBpbnB1dCkgPT4gZnV6emFsZHJpbi5maWx0ZXIoaXRlbXMsIGlucHV0KVxuXG5jb25zdCBhdXRvY29tcGxldGVJdGVtUmVuZGVyZXIgPSBwcm9wcyA9PiA8QXV0b2NvbXBsZXRlSXRlbSB7Li4ucHJvcHN9IC8+XG5cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wYXlwYWwvZG93bnNoaWZ0L2lzc3Vlcy8xNjRcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dG9jb21wbGV0ZSBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHRpdGxlOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMubm9kZV0pLFxuICAgIGl0ZW1zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICBzZWxlY3RlZEl0ZW06IFByb3BUeXBlcy5hbnksXG4gICAgZGVmYXVsdFNlbGVjdGVkSXRlbTogUHJvcFR5cGVzLmFueSxcbiAgICBpdGVtVG9TdHJpbmc6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgaXRlbVNpemU6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgcmVuZGVySXRlbTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgaXRlbXNGaWx0ZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIGlzRmlsdGVyRGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHBvcG92ZXJNaW5XaWR0aDogUHJvcFR5cGVzLm51bWJlcixcbiAgICBwb3BvdmVyTWF4SGVpZ2h0OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHVzZVNtYXJ0UG9zaXRpb25pbmc6IFByb3BUeXBlcy5ib29sLFxuICAgIC4uLkRvd25zaGlmdC5wcm9wVHlwZXNcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgaXRlbVRvU3RyaW5nOiBpID0+IChpID8gU3RyaW5nKGkpIDogJycpLFxuICAgIGl0ZW1TaXplOiAzMixcbiAgICBpdGVtc0ZpbHRlcjogZnV6enlGaWx0ZXIsXG4gICAgaXNGaWx0ZXJEaXNhYmxlZDogZmFsc2UsXG4gICAgcG9wb3Zlck1pbldpZHRoOiAyMDAsXG4gICAgcG9wb3Zlck1heEhlaWdodDogMjQwLFxuICAgIHVzZVNtYXJ0UG9zaXRpb25pbmc6IGZhbHNlLFxuICAgIHJlbmRlckl0ZW06IGF1dG9jb21wbGV0ZUl0ZW1SZW5kZXJlclxuICB9XG5cbiAgcmVuZGVyUmVzdWx0cyA9ICh7XG4gICAgd2lkdGgsXG4gICAgaW5wdXRWYWx1ZSxcbiAgICBoaWdobGlnaHRlZEluZGV4LFxuICAgIHNlbGVjdEl0ZW1BdEluZGV4LFxuICAgIHNlbGVjdGVkSXRlbSxcbiAgICBnZXRJdGVtUHJvcHNcbiAgfSkgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIHRpdGxlLFxuICAgICAgaXRlbVNpemUsXG4gICAgICBpdGVtc0ZpbHRlcixcbiAgICAgIGl0ZW1zOiBvcmlnaW5hbEl0ZW1zLFxuICAgICAgaXRlbVRvU3RyaW5nLFxuICAgICAgcmVuZGVySXRlbSxcbiAgICAgIHBvcG92ZXJNYXhIZWlnaHQsXG4gICAgICBpc0ZpbHRlckRpc2FibGVkXG4gICAgfSA9IHRoaXMucHJvcHNcblxuICAgIGNvbnN0IGl0ZW1zID1cbiAgICAgIGlzRmlsdGVyRGlzYWJsZWQgfHwgaW5wdXRWYWx1ZS50cmltKCkgPT09ICcnXG4gICAgICAgID8gb3JpZ2luYWxJdGVtc1xuICAgICAgICA6IGl0ZW1zRmlsdGVyKG9yaWdpbmFsSXRlbXMsIGlucHV0VmFsdWUpXG5cbiAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbFxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxQYW5lIHdpZHRoPXt3aWR0aH0+XG4gICAgICAgIHt0aXRsZSAmJiAoXG4gICAgICAgICAgPFBhbmUgcGFkZGluZz17OH0gYm9yZGVyQm90dG9tPVwiZXh0cmFNdXRlZFwiPlxuICAgICAgICAgICAgPFRleHQgc2l6ZT17MjAwfSBjb2xvcj1cIm11dGVkXCIgaXNVcHBlcmNhc2U+XG4gICAgICAgICAgICAgIHt0aXRsZX1cbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8L1BhbmU+XG4gICAgICAgICl9XG4gICAgICAgIHtpdGVtcy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgICA8VmlydHVhbExpc3RcbiAgICAgICAgICAgIHdpZHRoPVwiMTAwJVwiXG4gICAgICAgICAgICBoZWlnaHQ9e01hdGgubWluKGl0ZW1zLmxlbmd0aCAqIGl0ZW1TaXplLCBwb3BvdmVyTWF4SGVpZ2h0KX1cbiAgICAgICAgICAgIGl0ZW1TaXplPXtpdGVtU2l6ZX1cbiAgICAgICAgICAgIGl0ZW1Db3VudD17aXRlbXMubGVuZ3RofVxuICAgICAgICAgICAgc2Nyb2xsVG9JbmRleD17aGlnaGxpZ2h0ZWRJbmRleCB8fCAwfVxuICAgICAgICAgICAgb3ZlcnNjYW5Db3VudD17M31cbiAgICAgICAgICAgIHNjcm9sbFRvQWxpZ25tZW50PVwiYXV0b1wiXG4gICAgICAgICAgICByZW5kZXJJdGVtPXsoeyBpbmRleCwgc3R5bGUgfSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBpdGVtID0gaXRlbXNbaW5kZXhdXG4gICAgICAgICAgICAgIGNvbnN0IGl0ZW1TdHJpbmcgPSBpdGVtVG9TdHJpbmcoaXRlbSlcbiAgICAgICAgICAgICAgcmV0dXJuIHJlbmRlckl0ZW0oXG4gICAgICAgICAgICAgICAgZ2V0SXRlbVByb3BzKHtcbiAgICAgICAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICAgICAgICBrZXk6IGl0ZW1TdHJpbmcsXG4gICAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICAgIHN0eWxlLFxuICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGl0ZW1TdHJpbmcsXG4gICAgICAgICAgICAgICAgICBvbk1vdXNlVXA6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0SXRlbUF0SW5kZXgoaW5kZXgpXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgaXNTZWxlY3RlZDogc2VsZWN0ZWRJdGVtID09PSBpdGVtLFxuICAgICAgICAgICAgICAgICAgaXNIaWdobGlnaHRlZDogaGlnaGxpZ2h0ZWRJbmRleCA9PT0gaW5kZXhcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICA8L1BhbmU+XG4gICAgKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgaXRlbVNpemUsXG4gICAgICByZW5kZXJJdGVtLFxuICAgICAgaXRlbXNGaWx0ZXIsXG4gICAgICBwb3BvdmVyTWF4SGVpZ2h0LFxuICAgICAgdXNlU21hcnRQb3NpdGlvbmluZyxcbiAgICAgIHBvcG92ZXJNaW5XaWR0aCxcbiAgICAgIC4uLnByb3BzXG4gICAgfSA9IHRoaXMucHJvcHNcblxuICAgIHJldHVybiAoXG4gICAgICA8RG93bnNoaWZ0IHsuLi5wcm9wc30+XG4gICAgICAgIHsoe1xuICAgICAgICAgIGlzT3BlbixcbiAgICAgICAgICBpbnB1dFZhbHVlLFxuICAgICAgICAgIGdldEl0ZW1Qcm9wcyxcbiAgICAgICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICAgICAgaGlnaGxpZ2h0ZWRJbmRleCxcbiAgICAgICAgICBzZWxlY3RJdGVtQXRJbmRleCxcbiAgICAgICAgICAuLi5yZXN0RG93bnNoaWZ0UHJvcHNcbiAgICAgICAgfSkgPT4gKFxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8UG9wb3ZlclxuICAgICAgICAgICAgICBpc09wZW49e2lzT3Blbn1cbiAgICAgICAgICAgICAgbWluV2lkdGg9e3BvcG92ZXJNaW5XaWR0aH1cbiAgICAgICAgICAgICAgY29udGVudD17KHsgdGFyZ2V0UmVjdCB9KSA9PlxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyUmVzdWx0cyh7XG4gICAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5tYXgodGFyZ2V0UmVjdC53aWR0aCwgcG9wb3Zlck1pbldpZHRoKSxcbiAgICAgICAgICAgICAgICAgIGlucHV0VmFsdWUsXG4gICAgICAgICAgICAgICAgICBnZXRJdGVtUHJvcHMsXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZEl0ZW0sXG4gICAgICAgICAgICAgICAgICBoaWdobGlnaHRlZEluZGV4LFxuICAgICAgICAgICAgICAgICAgc2VsZWN0SXRlbUF0SW5kZXhcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG1pbkhlaWdodD17MH1cbiAgICAgICAgICAgICAgYW5pbWF0aW9uRHVyYXRpb249ezB9XG4gICAgICAgICAgICAgIHVzZVNtYXJ0UG9zaXRpb25pbmc9e3VzZVNtYXJ0UG9zaXRpb25pbmd9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHsoeyBpc09wZW46IGlzT3BlblBvcG92ZXIsIHRvZ2dsZSwgZ2V0UmVmLCBrZXkgfSkgPT5cbiAgICAgICAgICAgICAgICBjaGlsZHJlbih7XG4gICAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgICBpc09wZW46IGlzT3BlblBvcG92ZXIsXG4gICAgICAgICAgICAgICAgICB0b2dnbGUsXG4gICAgICAgICAgICAgICAgICBnZXRSZWYsXG4gICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlLFxuICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJdGVtLFxuICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZWRJbmRleCxcbiAgICAgICAgICAgICAgICAgIHNlbGVjdEl0ZW1BdEluZGV4LFxuICAgICAgICAgICAgICAgICAgLi4ucmVzdERvd25zaGlmdFByb3BzXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9Qb3BvdmVyPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9Eb3duc2hpZnQ+XG4gICAgKVxuICB9XG59XG4iXX0=