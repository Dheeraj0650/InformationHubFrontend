'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _Transition = require('react-transition-group/Transition');

var _Transition2 = _interopRequireDefault(_Transition);

var _uiBox = require('ui-box');

var _uiBox2 = _interopRequireDefault(_uiBox);

var _portal = require('../../portal');

var _colors = require('../../colors');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var animationEasing = {
  standard: 'cubic-bezier(0.4, 0.0, 0.2, 1)',
  deceleration: 'cubic-bezier(0.0, 0.0, 0.2, 1)',
  acceleration: 'cubic-bezier(0.4, 0.0, 1, 1)',
  sharp: 'cubic-bezier(0.4, 0.0, 0.6, 1)',
  spring: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'
};

var ANIMATION_DURATION = 240;

var fadeInAnimation = _uiBox.css.keyframes('fadeInAnimation', {
  from: {
    opacity: 0
  },
  to: {
    opacity: 1
  }
});

var fadeOutAnimation = _uiBox.css.keyframes('fadeOutAnimation', {
  from: {
    opacity: 1
  },
  to: {
    opacity: 0
  }
});

var animationStyles = {
  '&::before': {
    backgroundColor: _colors.colors.neutral['200A'],
    left: 0,
    top: 0,
    position: 'fixed',
    display: 'block',
    width: '100%',
    height: '100%',
    content: '" "'
  },
  '&[data-state="entering"]::before, &[data-state="entered"]::before': {
    animation: fadeInAnimation + ' ' + ANIMATION_DURATION + 'ms ' + animationEasing.deceleration + ' both'
  },
  '&[data-state="exiting"]::before, &[data-state="exited"]::before': {
    animation: fadeOutAnimation + ' ' + ANIMATION_DURATION + 'ms ' + animationEasing.acceleration + ' both'
  }

  /**
   * Overlay is essentially a wrapper around react-transition-group/Transition
   * Learn more: https://reactcommunity.org/react-transition-group/
   */
};
var Overlay = function (_React$Component) {
  _inherits(Overlay, _React$Component);

  function Overlay(props) {
    _classCallCheck(this, Overlay);

    var _this = _possibleConstructorReturn(this, (Overlay.__proto__ || Object.getPrototypeOf(Overlay)).call(this, props));

    _this.handleHidden = function (node) {
      _this.setState({ exiting: false });

      if (_this.props.onExited) {
        _this.props.onExited(node);
      }
    };

    _this.handleBackdropClick = function (e) {
      if (e.target !== e.currentTarget) {
        return;
      }

      _this.setState({ exiting: true });
      _this.props.onHide();
    };

    _this.handleClose = function () {
      _this.setState({ exiting: true });
      _this.props.onHide();
    };

    _this.state = {
      exiting: false
    };
    return _this;
  }

  _createClass(Overlay, [{
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _props = this.props,
          _props$containerProps = _props.containerProps,
          containerProps = _props$containerProps === undefined ? {} : _props$containerProps,
          isShown = _props.isShown,
          children = _props.children,
          onExit = _props.onExit,
          onExiting = _props.onExiting,
          onEnter = _props.onEnter,
          onEntering = _props.onEntering,
          onEntered = _props.onEntered;
      var exiting = this.state.exiting;


      return _react2.default.createElement(
        _portal.Portal,
        null,
        _react2.default.createElement(
          _Transition2.default,
          {
            appear: true,
            unmountOnExit: true,
            timeout: ANIMATION_DURATION,
            'in': isShown && !exiting,
            onExit: onExit,
            onExiting: onExiting,
            onExited: this.handleHidden,
            onEnter: onEnter,
            onEntering: onEntering,
            onEntered: onEntered
          },
          function (state) {
            return _react2.default.createElement(
              _uiBox2.default,
              _extends({
                onClick: _this2.handleBackdropClick,
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                zIndex: 40,
                css: animationStyles,
                'data-state': state
              }, containerProps),
              typeof children === 'function' ? children({
                state: state,
                close: _this2.handleClose
              }) : children
            );
          }
        )
      );
    }
  }]);

  return Overlay;
}(_react2.default.Component);

Overlay.propTypes = {
  /**
   * Children can be a node or a function accepting `close: func`
   * and `state: ENTERING | ENTERED | EXITING | EXITED`.
   */
  children: _propTypes2.default.oneOfType([_propTypes2.default.node, _propTypes2.default.func]).isRequired,

  /**
   * Show the component; triggers the enter or exit states.
   */
  isShown: _propTypes2.default.bool,

  /**
   * Props to be passed through on the inner Box.
   */
  containerProps: _propTypes2.default.object,

  /**
   * Callback fired as soon as backdrop is clicked or close is called.
   * Might get deprecated over time. Use `onExited` instead.
   */
  onHide: _propTypes2.default.func,

  /**
   * Callback fired before the "exiting" status is applied.
   * type: `Function(node: HtmlElement) -> void`
   */
  onExit: _propTypes2.default.func,

  /**
   * Callback fired after the "exiting" status is applied.
   * type: `Function(node: HtmlElement) -> void`
   */
  onExiting: _propTypes2.default.func,

  /**
   * Callback fired after the "exited" status is applied.
   * type: `Function(exitState: Any?, node: HtmlElement) -> void`
   */
  onExited: _propTypes2.default.func,

  /**
   * Callback fired before the "entering" status is applied.
   * An extra parameter isAppearing is supplied to indicate if the enter stage
   * is occurring on the initial mount.
   *
   * type: `Function(node: HtmlElement, isAppearing: bool) -> void`
   */
  onEnter: _propTypes2.default.func,

  /**
   * Callback fired after the "entering" status is applied.
   * An extra parameter isAppearing is supplied to indicate if the enter stage
   * is occurring on the initial mount.
   *
   * type: `Function(node: HtmlElement, isAppearing: bool) -> void`
   */
  onEntering: _propTypes2.default.func,

  /**
   * Callback fired after the "entered" status is applied.
   * An extra parameter isAppearing is supplied to indicate if the enter stage
   * is occurring on the initial mount.
   *
   * type: `Function(node: HtmlElement, isAppearing: bool) -> void`
   */
  onEntered: _propTypes2.default.func
};
Overlay.defaultProps = {
  onHide: function onHide() {},
  onExit: function onExit() {},
  onExiting: function onExiting() {},
  onExited: function onExited() {},
  onEnter: function onEnter() {},
  onEntering: function onEntering() {},
  onEntered: function onEntered() {}
};
exports.default = Overlay;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9vdmVybGF5L3NyYy9PdmVybGF5LmpzIl0sIm5hbWVzIjpbImFuaW1hdGlvbkVhc2luZyIsInN0YW5kYXJkIiwiZGVjZWxlcmF0aW9uIiwiYWNjZWxlcmF0aW9uIiwic2hhcnAiLCJzcHJpbmciLCJBTklNQVRJT05fRFVSQVRJT04iLCJmYWRlSW5BbmltYXRpb24iLCJrZXlmcmFtZXMiLCJmcm9tIiwib3BhY2l0eSIsInRvIiwiZmFkZU91dEFuaW1hdGlvbiIsImFuaW1hdGlvblN0eWxlcyIsImJhY2tncm91bmRDb2xvciIsIm5ldXRyYWwiLCJsZWZ0IiwidG9wIiwicG9zaXRpb24iLCJkaXNwbGF5Iiwid2lkdGgiLCJoZWlnaHQiLCJjb250ZW50IiwiYW5pbWF0aW9uIiwiT3ZlcmxheSIsInByb3BzIiwiaGFuZGxlSGlkZGVuIiwic2V0U3RhdGUiLCJleGl0aW5nIiwib25FeGl0ZWQiLCJub2RlIiwiaGFuZGxlQmFja2Ryb3BDbGljayIsImUiLCJ0YXJnZXQiLCJjdXJyZW50VGFyZ2V0Iiwib25IaWRlIiwiaGFuZGxlQ2xvc2UiLCJzdGF0ZSIsImNvbnRhaW5lclByb3BzIiwiaXNTaG93biIsImNoaWxkcmVuIiwib25FeGl0Iiwib25FeGl0aW5nIiwib25FbnRlciIsIm9uRW50ZXJpbmciLCJvbkVudGVyZWQiLCJjbG9zZSIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIm9uZU9mVHlwZSIsImZ1bmMiLCJpc1JlcXVpcmVkIiwiYm9vbCIsIm9iamVjdCIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxrQkFBa0I7QUFDdEJDLDRDQURzQjtBQUV0QkMsZ0RBRnNCO0FBR3RCQyw4Q0FIc0I7QUFJdEJDLHlDQUpzQjtBQUt0QkM7QUFMc0IsQ0FBeEI7O0FBUUEsSUFBTUMscUJBQXFCLEdBQTNCOztBQUVB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LGFBQVcscUJBQU0sQ0FBRTtBQVBDLEM7a0JBK0ZUckIsTyIsImZpbGUiOiJPdmVybGF5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IFRyYW5zaXRpb24gZnJvbSAncmVhY3QtdHJhbnNpdGlvbi1ncm91cC9UcmFuc2l0aW9uJ1xuaW1wb3J0IEJveCwgeyBjc3MgfSBmcm9tICd1aS1ib3gnXG5pbXBvcnQgeyBQb3J0YWwgfSBmcm9tICcuLi8uLi9wb3J0YWwnXG5pbXBvcnQgeyBjb2xvcnMgfSBmcm9tICcuLi8uLi9jb2xvcnMnXG5cbmNvbnN0IGFuaW1hdGlvbkVhc2luZyA9IHtcbiAgc3RhbmRhcmQ6IGBjdWJpYy1iZXppZXIoMC40LCAwLjAsIDAuMiwgMSlgLFxuICBkZWNlbGVyYXRpb246IGBjdWJpYy1iZXppZXIoMC4wLCAwLjAsIDAuMiwgMSlgLFxuICBhY2NlbGVyYXRpb246IGBjdWJpYy1iZXppZXIoMC40LCAwLjAsIDEsIDEpYCxcbiAgc2hhcnA6IGBjdWJpYy1iZXppZXIoMC40LCAwLjAsIDAuNiwgMSlgLFxuICBzcHJpbmc6IGBjdWJpYy1iZXppZXIoMC4xNzUsIDAuODg1LCAwLjMyMCwgMS4xNzUpYFxufVxuXG5jb25zdCBBTklNQVRJT05fRFVSQVRJT04gPSAyNDBcblxuY29uc3QgZmFkZUluQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnZmFkZUluQW5pbWF0aW9uJywge1xuICBmcm9tOiB7XG4gICAgb3BhY2l0eTogMFxuICB9LFxuICB0bzoge1xuICAgIG9wYWNpdHk6IDFcbiAgfVxufSlcblxuY29uc3QgZmFkZU91dEFuaW1hdGlvbiA9IGNzcy5rZXlmcmFtZXMoJ2ZhZGVPdXRBbmltYXRpb24nLCB7XG4gIGZyb206IHtcbiAgICBvcGFjaXR5OiAxXG4gIH0sXG4gIHRvOiB7XG4gICAgb3BhY2l0eTogMFxuICB9XG59KVxuXG5jb25zdCBhbmltYXRpb25TdHlsZXMgPSB7XG4gICcmOjpiZWZvcmUnOiB7XG4gICAgYmFja2dyb3VuZENvbG9yOiBjb2xvcnMubmV1dHJhbFsnMjAwQSddLFxuICAgIGxlZnQ6IDAsXG4gICAgdG9wOiAwLFxuICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgIGRpc3BsYXk6ICdibG9jaycsXG4gICAgd2lkdGg6ICcxMDAlJyxcbiAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICBjb250ZW50OiAnXCIgXCInXG4gIH0sXG4gICcmW2RhdGEtc3RhdGU9XCJlbnRlcmluZ1wiXTo6YmVmb3JlLCAmW2RhdGEtc3RhdGU9XCJlbnRlcmVkXCJdOjpiZWZvcmUnOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtmYWRlSW5BbmltYXRpb259ICR7QU5JTUFUSU9OX0RVUkFUSU9OfW1zICR7XG4gICAgICBhbmltYXRpb25FYXNpbmcuZGVjZWxlcmF0aW9uXG4gICAgfSBib3RoYFxuICB9LFxuICAnJltkYXRhLXN0YXRlPVwiZXhpdGluZ1wiXTo6YmVmb3JlLCAmW2RhdGEtc3RhdGU9XCJleGl0ZWRcIl06OmJlZm9yZSc6IHtcbiAgICBhbmltYXRpb246IGAke2ZhZGVPdXRBbmltYXRpb259ICR7QU5JTUFUSU9OX0RVUkFUSU9OfW1zICR7XG4gICAgICBhbmltYXRpb25FYXNpbmcuYWNjZWxlcmF0aW9uXG4gICAgfSBib3RoYFxuICB9XG59XG5cbi8qKlxuICogT3ZlcmxheSBpcyBlc3NlbnRpYWxseSBhIHdyYXBwZXIgYXJvdW5kIHJlYWN0LXRyYW5zaXRpb24tZ3JvdXAvVHJhbnNpdGlvblxuICogTGVhcm4gbW9yZTogaHR0cHM6Ly9yZWFjdGNvbW11bml0eS5vcmcvcmVhY3QtdHJhbnNpdGlvbi1ncm91cC9cbiAqL1xuY2xhc3MgT3ZlcmxheSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLyoqXG4gICAgICogQ2hpbGRyZW4gY2FuIGJlIGEgbm9kZSBvciBhIGZ1bmN0aW9uIGFjY2VwdGluZyBgY2xvc2U6IGZ1bmNgXG4gICAgICogYW5kIGBzdGF0ZTogRU5URVJJTkcgfCBFTlRFUkVEIHwgRVhJVElORyB8IEVYSVRFRGAuXG4gICAgICovXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5ub2RlLCBQcm9wVHlwZXMuZnVuY10pLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBjb21wb25lbnQ7IHRyaWdnZXJzIHRoZSBlbnRlciBvciBleGl0IHN0YXRlcy5cbiAgICAgKi9cbiAgICBpc1Nob3duOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIFByb3BzIHRvIGJlIHBhc3NlZCB0aHJvdWdoIG9uIHRoZSBpbm5lciBCb3guXG4gICAgICovXG4gICAgY29udGFpbmVyUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmaXJlZCBhcyBzb29uIGFzIGJhY2tkcm9wIGlzIGNsaWNrZWQgb3IgY2xvc2UgaXMgY2FsbGVkLlxuICAgICAqIE1pZ2h0IGdldCBkZXByZWNhdGVkIG92ZXIgdGltZS4gVXNlIGBvbkV4aXRlZGAgaW5zdGVhZC5cbiAgICAgKi9cbiAgICBvbkhpZGU6IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZmlyZWQgYmVmb3JlIHRoZSBcImV4aXRpbmdcIiBzdGF0dXMgaXMgYXBwbGllZC5cbiAgICAgKiB0eXBlOiBgRnVuY3Rpb24obm9kZTogSHRtbEVsZW1lbnQpIC0+IHZvaWRgXG4gICAgICovXG4gICAgb25FeGl0OiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZpcmVkIGFmdGVyIHRoZSBcImV4aXRpbmdcIiBzdGF0dXMgaXMgYXBwbGllZC5cbiAgICAgKiB0eXBlOiBgRnVuY3Rpb24obm9kZTogSHRtbEVsZW1lbnQpIC0+IHZvaWRgXG4gICAgICovXG4gICAgb25FeGl0aW5nOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZpcmVkIGFmdGVyIHRoZSBcImV4aXRlZFwiIHN0YXR1cyBpcyBhcHBsaWVkLlxuICAgICAqIHR5cGU6IGBGdW5jdGlvbihleGl0U3RhdGU6IEFueT8sIG5vZGU6IEh0bWxFbGVtZW50KSAtPiB2b2lkYFxuICAgICAqL1xuICAgIG9uRXhpdGVkOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZpcmVkIGJlZm9yZSB0aGUgXCJlbnRlcmluZ1wiIHN0YXR1cyBpcyBhcHBsaWVkLlxuICAgICAqIEFuIGV4dHJhIHBhcmFtZXRlciBpc0FwcGVhcmluZyBpcyBzdXBwbGllZCB0byBpbmRpY2F0ZSBpZiB0aGUgZW50ZXIgc3RhZ2VcbiAgICAgKiBpcyBvY2N1cnJpbmcgb24gdGhlIGluaXRpYWwgbW91bnQuXG4gICAgICpcbiAgICAgKiB0eXBlOiBgRnVuY3Rpb24obm9kZTogSHRtbEVsZW1lbnQsIGlzQXBwZWFyaW5nOiBib29sKSAtPiB2b2lkYFxuICAgICAqL1xuICAgIG9uRW50ZXI6IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZmlyZWQgYWZ0ZXIgdGhlIFwiZW50ZXJpbmdcIiBzdGF0dXMgaXMgYXBwbGllZC5cbiAgICAgKiBBbiBleHRyYSBwYXJhbWV0ZXIgaXNBcHBlYXJpbmcgaXMgc3VwcGxpZWQgdG8gaW5kaWNhdGUgaWYgdGhlIGVudGVyIHN0YWdlXG4gICAgICogaXMgb2NjdXJyaW5nIG9uIHRoZSBpbml0aWFsIG1vdW50LlxuICAgICAqXG4gICAgICogdHlwZTogYEZ1bmN0aW9uKG5vZGU6IEh0bWxFbGVtZW50LCBpc0FwcGVhcmluZzogYm9vbCkgLT4gdm9pZGBcbiAgICAgKi9cbiAgICBvbkVudGVyaW5nOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZpcmVkIGFmdGVyIHRoZSBcImVudGVyZWRcIiBzdGF0dXMgaXMgYXBwbGllZC5cbiAgICAgKiBBbiBleHRyYSBwYXJhbWV0ZXIgaXNBcHBlYXJpbmcgaXMgc3VwcGxpZWQgdG8gaW5kaWNhdGUgaWYgdGhlIGVudGVyIHN0YWdlXG4gICAgICogaXMgb2NjdXJyaW5nIG9uIHRoZSBpbml0aWFsIG1vdW50LlxuICAgICAqXG4gICAgICogdHlwZTogYEZ1bmN0aW9uKG5vZGU6IEh0bWxFbGVtZW50LCBpc0FwcGVhcmluZzogYm9vbCkgLT4gdm9pZGBcbiAgICAgKi9cbiAgICBvbkVudGVyZWQ6IFByb3BUeXBlcy5mdW5jXG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIG9uSGlkZTogKCkgPT4ge30sXG4gICAgb25FeGl0OiAoKSA9PiB7fSxcbiAgICBvbkV4aXRpbmc6ICgpID0+IHt9LFxuICAgIG9uRXhpdGVkOiAoKSA9PiB7fSxcbiAgICBvbkVudGVyOiAoKSA9PiB7fSxcbiAgICBvbkVudGVyaW5nOiAoKSA9PiB7fSxcbiAgICBvbkVudGVyZWQ6ICgpID0+IHt9XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKVxuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGV4aXRpbmc6IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgaGFuZGxlSGlkZGVuID0gbm9kZSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGV4aXRpbmc6IGZhbHNlIH0pXG5cbiAgICBpZiAodGhpcy5wcm9wcy5vbkV4aXRlZCkge1xuICAgICAgdGhpcy5wcm9wcy5vbkV4aXRlZChub2RlKVxuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUJhY2tkcm9wQ2xpY2sgPSBlID0+IHtcbiAgICBpZiAoZS50YXJnZXQgIT09IGUuY3VycmVudFRhcmdldCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7IGV4aXRpbmc6IHRydWUgfSlcbiAgICB0aGlzLnByb3BzLm9uSGlkZSgpXG4gIH1cblxuICBoYW5kbGVDbG9zZSA9ICgpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHsgZXhpdGluZzogdHJ1ZSB9KVxuICAgIHRoaXMucHJvcHMub25IaWRlKClcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBjb250YWluZXJQcm9wcyA9IHt9LFxuICAgICAgaXNTaG93bixcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgb25FeGl0LFxuICAgICAgb25FeGl0aW5nLFxuICAgICAgb25FbnRlcixcbiAgICAgIG9uRW50ZXJpbmcsXG4gICAgICBvbkVudGVyZWRcbiAgICB9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3QgeyBleGl0aW5nIH0gPSB0aGlzLnN0YXRlXG5cbiAgICByZXR1cm4gKFxuICAgICAgPFBvcnRhbD5cbiAgICAgICAgPFRyYW5zaXRpb25cbiAgICAgICAgICBhcHBlYXJcbiAgICAgICAgICB1bm1vdW50T25FeGl0XG4gICAgICAgICAgdGltZW91dD17QU5JTUFUSU9OX0RVUkFUSU9OfVxuICAgICAgICAgIGluPXtpc1Nob3duICYmICFleGl0aW5nfVxuICAgICAgICAgIG9uRXhpdD17b25FeGl0fVxuICAgICAgICAgIG9uRXhpdGluZz17b25FeGl0aW5nfVxuICAgICAgICAgIG9uRXhpdGVkPXt0aGlzLmhhbmRsZUhpZGRlbn1cbiAgICAgICAgICBvbkVudGVyPXtvbkVudGVyfVxuICAgICAgICAgIG9uRW50ZXJpbmc9e29uRW50ZXJpbmd9XG4gICAgICAgICAgb25FbnRlcmVkPXtvbkVudGVyZWR9XG4gICAgICAgID5cbiAgICAgICAgICB7c3RhdGUgPT4gKFxuICAgICAgICAgICAgPEJveFxuICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLmhhbmRsZUJhY2tkcm9wQ2xpY2t9XG4gICAgICAgICAgICAgIHBvc2l0aW9uPVwiZml4ZWRcIlxuICAgICAgICAgICAgICB0b3A9ezB9XG4gICAgICAgICAgICAgIGxlZnQ9ezB9XG4gICAgICAgICAgICAgIHJpZ2h0PXswfVxuICAgICAgICAgICAgICBib3R0b209ezB9XG4gICAgICAgICAgICAgIHpJbmRleD17NDB9XG4gICAgICAgICAgICAgIGNzcz17YW5pbWF0aW9uU3R5bGVzfVxuICAgICAgICAgICAgICBkYXRhLXN0YXRlPXtzdGF0ZX1cbiAgICAgICAgICAgICAgey4uLmNvbnRhaW5lclByb3BzfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7dHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgPyBjaGlsZHJlbih7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLFxuICAgICAgICAgICAgICAgICAgICBjbG9zZTogdGhpcy5oYW5kbGVDbG9zZVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6IGNoaWxkcmVufVxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9UcmFuc2l0aW9uPlxuICAgICAgPC9Qb3J0YWw+XG4gICAgKVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE92ZXJsYXlcbiJdfQ==